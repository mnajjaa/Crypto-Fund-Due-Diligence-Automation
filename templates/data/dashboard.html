{% extends 'base2.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">CryptoIQ</a>
      <div class="d-flex">
        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#">Profile</a></li>
            <li><a class="dropdown-item" href="#">Settings</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Search Bar with AI Suggestions -->
  <div class="row mt-3 mx-2">
    <div class="col-12 position-relative">
      <input type="text" class="form-control search-bar" 
             placeholder="Search coins, metrics, or ask AI..." 
             id="mainSearch">
      <div class="ai-suggestions shadow">
        <div class="suggestion-item">Explain current BTC price trend <i class="bi bi-lightbulb"></i></div>
        <div class="suggestion-item">Show top DeFi projects by TVL <i class="bi bi-graph-up"></i></div>
      </div>
    </div>
  </div>

  <!-- First Row: Chart + News/Sentiment -->
<div class="row mt-3 gx-2">
  <!-- Candlestick Chart -->
  <div class="col-lg-7">
    <div class="chart-container card">
    
      <div class="card-body p-0" style="height: 500px;">
        <!-- TradingView Widget BEGIN -->
        <div class="tradingview-widget-container" style="height:100%;width:100%">
          <div class="tradingview-widget-container__widget" 
               style="height:calc(100% - 32px);width:100%"></div>
          <div class="tradingview-widget-copyright">
            <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank">
              <span class="blue-text">Track all markets on TradingView</span>
            </a>
          </div>
          <script type="text/javascript" 
                  src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" 
                  async>
          {
            "autosize": true,
            "symbol": "BINANCE:BTCUSDT",
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "dark",
            "style": "1",
            "locale": "en",
            "withdateranges": true,
            "hide_side_toolbar": false,
            "allow_symbol_change": true,
            "support_host": "https://www.tradingview.com"
          }
          </script>
        </div>
        <!-- TradingView Widget END -->
      </div>
    </div>
  </div>

  <!-- News & Sentiment Stack -->
  <!-- News & Sentiment Stack (40%) -->
  <div class="col-lg-5 mt-3 mt-lg-0">
    <!-- News Card -->
    <div class="card news-card mb-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="m-0">Latest Crypto News</h5>
        <i class="bi bi-newspaper fs-5 text-primary"></i>
      </div>
      <div class="card-body news-scroll">
        <div class="news-item">
          <div class="news-img">
            <img src="{% static 'assets/img/crypto1.jpg' %}" class="img-fluid rounded" alt="News image">
          </div>
          <div class="news-body">
            <label class="d-block mb-1 text-primary fs-sm">Crypto Ninja</label>
            <h6 class="news-title">
              <a href="#" class="text-reset">Dow Futures, Bitcoin Teeter as Markets Wait for FOMC Bounce</a>
            </h6>
            <p class="news-text text-muted mb-0">As the unwelcome bearish momentum returns to all top cryptocurrency markets...</p>
          </div>
        </div>

        <div class="news-item mt-3">
          <div class="news-img">
            <img src="{% static 'assets/img/crypto2.jpg' %}" class="img-fluid rounded" alt="News image">
          </div>
          <div class="news-body">
            <label class="d-block mb-1 text-primary fs-sm">Cable News Network</label>
            <h6 class="news-title">
              <a href="#" class="text-reset">XRP Price Remains Bearish as XRP/BTC Drops Below 7,800 Satoshi</a>
            </h6>
            <p class="news-text text-muted mb-0">Liquidity has shifted away from the top gaining crypto assets...</p>
          </div>
        </div>

        <!-- Add more news items -->
      </div>
    </div>

    <!-- Sentiment Card -->
    <div class="card sentiment-card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="m-0">Market Sentiment</h5>
        <div class="sentiment-score negative">
          <i class="bi bi-emoji-angry"></i>
          -0.42
        </div>
      </div>
      <div class="card-body">
        <div class="sentiment-progress">
          <div class="progress">
            <div class="progress-bar bg-danger" role="progressbar" 
                 style="width: 70%" aria-valuenow="70" aria-valuemin="0" 
                 aria-valuemax="100"></div>
          </div>
          <div class="sentiment-labels d-flex justify-content-between mt-2">
            <span>Fear</span>
            <span>Greed</span>
          </div>
        </div>
        <div class="sentiment-breakdown mt-3">
          <div class="sentiment-source d-flex justify-content-between">
            <span>Twitter</span>
            <span class="text-danger">-0.52</span>
          </div>
          <div class="sentiment-source d-flex justify-content-between">
            <span>Reddit</span>
            <span class="text-warning">-0.21</span>
          </div>
          <div class="sentiment-source d-flex justify-content-between">
            <span>News</span>
            <span class="text-success">+0.15</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Style Additions -->
<style>
.news-card { height: 55vh; }
.news-scroll { overflow-y: auto; }
.news-item { 
  padding: 1rem;
  border-bottom: 1px solid #2a2a2a;
}
.news-item:hover { background: rgba(255,255,255,0.05); }
.news-img { 
  width: 80px;
  height: 80px;
  overflow: hidden;
  border-radius: 8px;
}
.news-body { margin-left: 95px; }
.news-title { font-size: 0.95rem; }
.news-text { font-size: 0.85rem; }

.sentiment-card { height: 30vh; }
.sentiment-progress .progress {
  height: 8px;
  border-radius: 4px;
  background: #2a2a2a;
}
.sentiment-score {
  font-weight: 600;
  font-size: 1.1rem;
}
</style>
</div>

  <!-- Second Row: 2x3 KPI Cards -->
  <div class="row mt-3 gx-2">
    <div class="col-6 col-md-4 col-lg-2 mb-2">
      <div class="kpi-card">
        <div class="kpi-header">
          <span>Market Cap</span>
          <i class="bi bi-info-circle" data-bs-toggle="tooltip" 
             title="Total cryptocurrency market valuation"></i>
        </div>
        <div class="kpi-value">$2.4T</div>
        <div class="kpi-trend positive">â–² 3.1%</div>
      </div>
    </div>
    <!-- Repeat 5 more KPI cards -->
  </div>

  <!-- Third Row: Drag & Drop Dashboard -->
  <div class="row mt-3">
    <div class="col-12">
      <div class="dashboard-grid" id="dashboardGrid">
        <div class="grid-item" data-type="kpi">
          <div class="dashboard-card">
            <div class="card-header">Custom KPI</div>
            <div class="card-body">Add your metrics</div>
          </div>
        </div>
        <!-- More grid items -->
      </div>
    </div>
  </div>

  <!-- AI Context Bar -->
  <div class="ai-context-bar">
    <div class="ai-message">
      <i class="bi bi-robot"></i>
      <span>Current volatility (82/100) suggests caution - similar to pre-LUNA collapse levels</span>
    </div>
  </div>

</div>

<!-- Styles -->
<style>
.search-bar { padding-right: 40px; }
.ai-suggestions {
  position: absolute;
  width: 100%;
  background: #1a1d21;
  border-radius: 0 0 8px 8px;
  display: none;
  z-index: 1000;
}
.suggestion-item {
  padding: 12px;
  border-bottom: 1px solid #2a2a2a;
  cursor: pointer;
}
.kpi-card {
  background: #1a1d21;
  border-radius: 8px;
  padding: 1rem;
  height: 120px;
}
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1rem;
  min-height: 400px;
  background: #1a1d21;
  border-radius: 8px;
  padding: 1rem;
}
.sentiment-meter {
  height: 20px;
  background: #2a2a2a;
  border-radius: 10px;
  position: relative;
}
.sentiment-fill {
  height: 100%;
  border-radius: 10px;
  transition: width 0.5s ease;
}
</style>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
// Initialize drag and drop
new Sortable(document.getElementById('dashboardGrid'), {
  animation: 150,
  ghostClass: 'dragging-ghost',
  chosenClass: 'dragging-item'
});

// Search bar interactions
document.getElementById('mainSearch').addEventListener('focus', () => {
  document.querySelector('.ai-suggestions').style.display = 'block';
});

document.addEventListener('click', (e) => {
  if (!e.target.closest('.search-bar')) {
    document.querySelector('.ai-suggestions').style.display = 'none';
  }
});
</script>
{% endblock %}