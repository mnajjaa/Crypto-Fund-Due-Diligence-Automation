<!-- profile2.html -->
{% extends 'baseTim.html' %}
{% load static %}

{% block title %}Profile{% endblock %}

         {% block nav %}
         <nav  aria-label="breadcrumb" class="ps-2">
          
          <ol class="breadcrumb bg-transparent mb-0 p-0 me-sm-6 me-5">
            <li class=" text-sm p-1">Pages  / </li>
            <li class=" text-sm p-1">Account  / </li>
            <li class=" text-sm p-1 text-dark active font-weight-bold" aria-current="page"> Settings</li>
        </ol>
    </nav>

      
      
          {% endblock %} 
          
  
      {% block content %}

      <div class="row align-items-start flex-column">
        <div class="col-lg-5 ms-3 col-sm-8">
          <h3 class="mb-0 h4 font-weight-bolder">Settings</h3>
          <p class="mb-4">
            Check the sales, value and bounce rate by country.
          </p>
        </div>
        <div class="col-lg-4 col-sm-8">
          <div class="nav-wrapper position-relative end-0">
            <ul class="nav nav-pills nav-fill p-1" role="tablist">
              <li class="nav-item">
                <a class="nav-link mb-0 px-0 py-1 active  active " data-bs-toggle="tab" href="../../examples/pages/account/settings.html" role="tab" aria-selected="true">
                  Messages
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link mb-0 px-0 py-1 " data-bs-toggle="tab" href="../../examples/pages/account/billing.html" role="tab" aria-selected="false">
                  Social
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link mb-0 px-0 py-1 " data-bs-toggle="tab" href="../../examples/pages/account/invoice.html" role="tab" aria-selected="false">
                  Notifications
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link mb-0 px-0 py-1 " data-bs-toggle="tab" href="../../examples/pages/account/security.html" role="tab" aria-selected="false">
                  Backup
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid my-3 py-3">
      <div class="row mb-5">
        <div class="col-lg-3">
          <div class="card position-sticky top-1">
            <ul class="nav flex-column bg-white border-radius-lg p-3">
              <li class="nav-item">
                <a class="nav-link text-dark d-flex" data-scroll="" href="#profile">
                  <i class="material-symbols-rounded text-lg me-2">person</i>
                  <span class="text-sm">Profile</span>
                </a>
              </li>
              <li class="nav-item pt-2">
                <a class="nav-link text-dark d-flex" data-scroll="" href="#basic-info">
                  <i class="material-symbols-rounded text-lg me-2">receipt_long</i>
                  <span class="text-sm">Basic Info</span>
                </a>
              </li>
              <li class="nav-item pt-2">
                <a class="nav-link text-dark d-flex" data-scroll="" href="#password">
                  <i class="material-symbols-rounded text-lg me-2">lock</i>
                  <span class="text-sm">Change Password</span>
                </a>
              </li>
              <li class="nav-item pt-2">
                <a class="nav-link text-dark d-flex" data-scroll="" href="#2fa">
                  <i class="material-symbols-rounded text-lg me-2">security</i>
                  <span class="text-sm">2FA</span>
                </a>
              </li>
              <li class="nav-item pt-2">
                <a class="nav-link text-dark d-flex" data-scroll="" href="#accounts">
                  <i class="material-symbols-rounded text-lg me-2">badge</i>
                  <span class="text-sm">Accounts</span>
                </a>
              </li>
              <li class="nav-item pt-2">
                <a class="nav-link text-dark d-flex" data-scroll="" href="#notifications">
                  <i class="material-symbols-rounded text-lg me-2">campaign</i>
                  <span class="text-sm">Notifications</span>
                </a>
              </li>
              <li class="nav-item pt-2">
                <a class="nav-link text-dark d-flex" data-scroll="" href="#sessions">
                  <i class="material-symbols-rounded text-lg me-2">settings_applications</i>
                  <span class="text-sm">Sessions</span>
                </a>
              </li>
              <li class="nav-item pt-2">
                <a class="nav-link text-dark d-flex" data-scroll="" href="#delete">
                  <i class="material-symbols-rounded text-lg me-2">delete</i>
                  <span class="text-sm">Delete Account</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-lg-9 mt-lg-0 mt-4">
          <!-- Card Profile -->
          <div class="card card-body" id="profile">
            <div class="row justify-content-center align-items-center">
              <div class="col-sm-auto col-4">
                <div class="avatar avatar-xl position-relative">
                  {% if profile.profile_picture %}
                  <img src="{{ profile.profile_picture.url }}" alt="Profile Picture" class="w-100 rounded-circle shadow-sm">
              {% else %}
                  <img src="/media/profile_pics/Default_pfp.svg.png" alt="Default Profile Picture" class="w-100 rounded-circle shadow-sm">
              {% endif %}
              
                </div>
              </div>
              <div class="col-sm-auto col-8 my-auto">
                <div class="h-100">
                  <h5 class="mb-1 font-weight-bolder">
                    {{ profile.user.first_name }} {{ profile.user.last_name }}                  </h5>
                  <p class="mb-0 font-weight-normal text-sm">
                    {{ profile.user.username }}, {{ profile.user.email }}
                  </p>
                </div>
              </div>
              <div class="col-sm-auto ms-sm-auto mt-sm-0 mt-3 d-flex">
                <label class="form-check-label mb-0">
                  <small id="profileVisibility">
                    Switch to invisible
                  </small>
                </label>
                <div class="form-check form-switch ms-2 my-auto">
                  <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault23" checked onchange="visible()">
                </div>
              </div>
            </div>
          </div>
          <!-- Card Edit Form Basic Info -->
          <div class="card mt-4" id="basic-info">
            <div class="card-header">
              <h5>Basic Info</h5>
            </div>
            <div class="card-body pt-0">
              <form method="post" action="{% url 'edit_profile' %}" enctype="multipart/form-data">
                {% csrf_token %}

              <div class="row">
                <div class="col-6">
                  <div class="input-group input-group-static">
                    <label  for="first_name" class="form-label">First Name</label>
                    <input type="text" id="first_name" class="form-control" name="first_name" value="{{ form.first_name.value|default:profile.user.first_name }}" required>
                  </div>
                </div>
                <div class="col-6">
                  <div class="input-group input-group-static">
                    <label  for="last_name" class="form-label">Last Name</label>
                    <input type="text"  id="last_name" class="form-control" name="last_name" value="{{ form.last_name.value|default:profile.user.last_name }}" required>
                  </div>
                </div>
              </div>
              
              <div class="row mt-4">
                <div class="col-6">
                  <div class="input-group input-group-static">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" class="form-control" name="username" value="{{ form.username.value|default:profile.user.username }}" required>
                  </div>
                </div>
                <div class="col-6">
                  <div class="input-group input-group-static">
                    <label for="email" class="form-label"> Email</label>
                    <input type="email" id="email" class="form-control" name="email" value="{{ form.email.value|default:profile.user.email }}" required>
                  </div>
                </div>
              </div>
              
              <div class="row">
                          <!-- upload profile image -->
                          
             <div class="col-md-6 align-self-center">
              <label class="form-label">Profile Picture</label>
              <input type="file" class="form-control" name="profile_picture" accept="image/*">
                </div>
                <div class="col-md-6 align-self-center">
                  <button class="btn bg-gradient-dark btn-sm float-end mt-6 mb-0">Update</button>

                </div>
                  
              </div>
            </form>
            </div>
          </div>
          <!-- Card Change Password -->
<div class="card mt-4" id="password">
  <div class="card-header">
    <h5>Change Password</h5>
  </div>
  <div class="card-body pt-0">
    <!-- Display messages (success/error) -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Change Password Form -->
    <form method="post" action="{% url 'change_password' %}">
      {% csrf_token %}
      <!-- Current Password -->
      <div class="input-group input-group-outline">
        <label class="form-label">Current password</label>
        <input type="password" class="form-control" name="current_password" required>
      </div>
      <!-- New Password -->
      <div class="input-group input-group-outline my-4">
        <label class="form-label">New password</label>
        <input type="password" class="form-control" name="new_password" required>
      </div>
      <!-- Confirm New Password -->
      <div class="input-group input-group-outline">
        <label class="form-label">Confirm New password</label>
        <input type="password" class="form-control" name="confirm_new_password" required>
      </div>

      <!-- Password Requirements -->
      <h5 class="mt-5">Password requirements</h5>
      <p class="text-muted mb-2">
        Please follow this guide for a strong password:
      </p>
      <ul class="text-muted ps-4 mb-0 float-start">
        <li>
          <span class="text-sm">One special character</span>
        </li>
        <li>
          <span class="text-sm">Min 6 characters</span>
        </li>
        <li>
          <span class="text-sm">One number (2 are recommended)</span>
        </li>
        <li>
          <span class="text-sm">Change it often</span>
        </li>
      </ul>

      <!-- Submit Button -->
      <button type="submit" class="btn bg-gradient-dark btn-sm float-end mt-6 mb-0">Update password</button>
    </form>
  </div>
</div>
<!-- End Card Change Password -->
<!-- Two-factor authentication -->
<div class="card mt-4" id="2fa">
  <div class="card-header d-flex">
      <h5 class="mb-0">Two-factor authentication</h5>
      <span class="badge {% if profile.is_2fa_enabled %}badge-success{% else %}badge-danger{% endif %} ms-auto" id="2faStatusBadge">
        {% if profile.is_2fa_enabled %}Enabled{% else %}Disabled{% endif %}
      </span>
  </div>
  <div class="card-body">
      <div class="d-flex align-items-center">
          <div class="form-check form-switch ms-3">
              <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault" {% if profile.is_2fa_enabled %}checked{% endif %}>
              <label class="form-check-label" for="flexSwitchCheckDefault">{% if profile.is_2fa_enabled %}Disable 2FA{% else %}Enable 2FA{% endif %}</label>
          </div>
      </div>

      <!-- QR Code and OTP Input (Visible only when 2FA is enabled) -->
      <div id="2faSetup" style="display: none;">
          <div class="row">
              <!-- QR Code Column -->
              <div class="col-md-6 text-center">
                  <img id="qrCodeImage" src="" alt="QR Code" class="img-fluid" style="max-width: 200px;">
                  <p class="text-muted mt-2">Scan this QR code with your authenticator app.</p>
              </div>

              <!-- OTP Input and Buttons Column -->
              <div class="col-md-6">
                  <form method="POST" action="{% url 'verify_2fa_setup' %}" id="otpForm">
                      {% csrf_token %}
                      <div class="mb-3">
                          <label for="otpToken" class="form-label">Enter OTP</label>
                          <div class="d-flex gap-2">
                              {% for i in "123456" %}
                                  <input type="text" class="form-control form-control-sm text-center" maxlength="1" autocomplete="off" autocapitalize="off" name="token_{{ i }}" required style="width: 40px;">
                              {% endfor %}
                          </div>
                      </div>
                      <div class="d-flex gap-2">
                          <button type="submit" class="btn bg-gradient-dark btn-sm">Verify</button>
                          <button type="button" class="btn btn-sm btn-outline-dark" id="cancel2FAButton">Cancel</button>
                      </div>
                  </form>
              </div>
          </div>
      </div>
  </div>
</div>
          <!-- Card Accounts -->
          
          <!-- Card Notifications -->
          <div class="card mt-4" id="notifications">
            <div class="card-header">
              <h5>Notifications</h5>
              <p class="text-sm">Choose how you receive notifications. These notification settings apply to the things you’re watching.</p>
            </div>
            <div class="card-body pt-0">
              <div class="table-responsive">
                <table class="table mb-0">
                  <thead>
                    <tr>
                      <th class="ps-1" colspan="4">
                        <p class="mb-0">Activity</p>
                      </th>
                      <th class="text-center">
                        <p class="mb-0">Email</p>
                      </th>
                      <th class="text-center">
                        <p class="mb-0">Push</p>
                      </th>
                      <th class="text-center">
                        <p class="mb-0">SMS</p>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="ps-1" colspan="4">
                        <div class="my-auto">
                          <span class="text-dark d-block text-sm">Mentions</span>
                          <span class="text-xs font-weight-normal">Notify when another user mentions you in a comment</span>
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" checked type="checkbox" id="flexSwitchCheckDefault11">
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault12">
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault13">
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td class="ps-1" colspan="4">
                        <div class="my-auto">
                          <span class="text-dark d-block text-sm">Comments</span>
                          <span class="text-xs font-weight-normal">Notify when another user comments your item.</span>
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" checked type="checkbox" id="flexSwitchCheckDefault14">
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" checked type="checkbox" id="flexSwitchCheckDefault15">
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault16">
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td class="ps-1" colspan="4">
                        <div class="my-auto">
                          <span class="text-dark d-block text-sm">Follows</span>
                          <span class="text-xs font-weight-normal">Notify when another user follows you.</span>
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault17">
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" checked type="checkbox" id="flexSwitchCheckDefault18">
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault19">
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td class="ps-1" colspan="4">
                        <div class="my-auto">
                          <p class="text-sm mb-0">Log in from a new device</p>
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" checked type="checkbox" id="flexSwitchCheckDefault20">
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" checked type="checkbox" id="flexSwitchCheckDefault21">
                        </div>
                      </td>
                      <td>
                        <div class="form-check form-switch mb-0 d-flex align-items-center justify-content-center">
                          <input class="form-check-input" checked type="checkbox" id="flexSwitchCheckDefault22">
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Card Sessions -->
          <div class="card mt-4" id="sessions">
            <div class="card-header pb-3">
              <h5>Sessions</h5>
              <p class="text-sm">This is a list of devices that have logged into your account. Remove those that you do not recognize.</p>
            </div>
            <div class="card-body pt-0">
              <div class="d-flex align-items-center">
                <div class="text-center w-5">
                  <i class="fas fa-desktop text-lg opacity-6"></i>
                </div>
                <div class="my-auto ms-3">
                  <div class="h-100">
                    <p class="text-sm mb-1">
                      Bucharest 68.133.163.201
                    </p>
                    <p class="mb-0 text-xs">
                      Your current session
                    </p>
                  </div>
                </div>
                <span class="badge badge-success badge-sm my-auto ms-auto me-3">Active</span>
                <p class="text-secondary text-sm my-auto me-3">EU</p>
                <a href="javascript:;" class="text-primary text-sm icon-move-right my-auto">See more
                  <i class="fas fa-arrow-right text-xs ms-1" aria-hidden="true"></i>
                </a>
              </div>
              <hr class="horizontal dark">
              <div class="d-flex align-items-center">
                <div class="text-center w-5">
                  <i class="fas fa-desktop text-lg opacity-6"></i>
                </div>
                <p class="my-auto ms-3">Chrome on macOS</p>
                <p class="text-secondary text-sm ms-auto my-auto me-3">US</p>
                <a href="javascript:;" class="text-primary text-sm icon-move-right my-auto">See more
                  <i class="fas fa-arrow-right text-xs ms-1" aria-hidden="true"></i>
                </a>
              </div>
              <hr class="horizontal dark">
              <div class="d-flex align-items-center">
                <div class="text-center w-5">
                  <i class="fas fa-mobile text-lg opacity-6"></i>
                </div>
                <p class="my-auto ms-3">Safari on iPhone</p>
                <p class="text-secondary text-sm ms-auto my-auto me-3">US</p>
                <a href="javascript:;" class="text-primary text-sm icon-move-right my-auto">See more
                  <i class="fas fa-arrow-right text-xs ms-1" aria-hidden="true"></i>
                </a>
              </div>
            </div>
          </div>
          <!-- Card Delete Account -->
          <div class="card mt-4" id="delete">
            <div class="card-body">
              <div class="d-flex align-items-center mb-sm-0 mb-4">
                <div class="w-50">
                  <h5>Delete Account</h5>
                  <p class="text-sm mb-0">Once you delete your account, there is no going back. Please be certain.</p>
                </div>
                <div class="w-50 text-end">
                  <button class="btn btn-outline-secondary mb-3 mb-md-0 ms-auto" type="button" name="button">Deactivate</button>
                  <button class="btn bg-gradient-danger mb-0 ms-2" type="button" name="button">Delete Account</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script>
        (function(a, s, y, n, c, h, i, d, e) {
          s.className += ' ' + y;
          h.start = 1 * new Date;
          h.end = i = function() {
            s.className = s.className.replace(RegExp(' ?' + y), '')
          };
          (a[n] = a[n] || []).hide = h;
          setTimeout(function() {
            i();
            h.end = null
          }, c);
          h.timeout = c;
        })(window, document.documentElement, 'async-hide', 'dataLayer', 4000, {
          'GTM-K9BGS8K': true
        });
      </script>
      <!-- Analytics-Optimize Snippet -->
      <script>
        (function(i, s, o, g, r, a, m) {
          i['GoogleAnalyticsObject'] = r;
          i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
          }, i[r].l = 1 * new Date();
          a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
          a.async = 1;
          a.src = g;
          m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-46172202-22', 'auto', {
          allowLinker: true
        });
        ga('set', 'anonymizeIp', true);
        ga('require', 'GTM-K9BGS8K');
        ga('require', 'displayfeatures');
        ga('require', 'linker');
        ga('linker:autoLink', ["2checkout.com", "avangate.com"]);
      </script>
      <!-- end Analytics-Optimize Snippet -->
      <!-- Google Tag Manager -->
      <script>
        (function(w, d, s, l, i) {
          w[l] = w[l] || [];
          w[l].push({
            'gtm.start': new Date().getTime(),
            event: 'gtm.js'
          });
          var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != 'dataLayer' ? '&l=' + l : '';
          j.async = true;
          j.src =
            'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
          f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-NKDMSK6');
      </script>
      <!-- Kanban scripts -->
  <script src="{%static 'js/plugins/dragula/dragula.min.js' %}"></script>
  <script src="{%static 'js/plugins/jkanban/jkanban.min.js' %}"></script>
  <script>
    if (document.getElementById('choices-gender')) {
      var gender = document.getElementById('choices-gender');
      const example = new Choices(gender);
    }

    if (document.getElementById('choices-language')) {
      var language = document.getElementById('choices-language');
      const example = new Choices(language);
    }

    if (document.getElementById('choices-skills')) {
      var skills = document.getElementById('choices-skills');
      const example = new Choices(skills, {
        delimiter: ',',
        editItems: true,
        maxItemCount: 5,
        removeItemButton: true,
        addItems: true
      });
    }

    if (document.getElementById('choices-year')) {
      var year = document.getElementById('choices-year');
      setTimeout(function() {
        const example = new Choices(year);
      }, 1);

      for (y = 1900; y <= 2020; y++) {
        var optn = document.createElement("OPTION");
        optn.text = y;
        optn.value = y;

        if (y == 2020) {
          optn.selected = true;
        }

        year.options.add(optn);
      }
    }

    if (document.getElementById('choices-day')) {
      var day = document.getElementById('choices-day');
      setTimeout(function() {
        const example = new Choices(day);
      }, 1);


      for (y = 1; y <= 31; y++) {
        var optn = document.createElement("OPTION");
        optn.text = y;
        optn.value = y;

        if (y == 1) {
          optn.selected = true;
        }

        day.options.add(optn);
      }

    }

    if (document.getElementById('choices-month')) {
      var month = document.getElementById('choices-month');
      setTimeout(function() {
        const example = new Choices(month);
      }, 1);

      var d = new Date();
      var monthArray = new Array();
      monthArray[0] = "January";
      monthArray[1] = "February";
      monthArray[2] = "March";
      monthArray[3] = "April";
      monthArray[4] = "May";
      monthArray[5] = "June";
      monthArray[6] = "July";
      monthArray[7] = "August";
      monthArray[8] = "September";
      monthArray[9] = "October";
      monthArray[10] = "November";
      monthArray[11] = "December";
      for (m = 0; m <= 11; m++) {
        var optn = document.createElement("OPTION");
        optn.text = monthArray[m];
        // server side month start from one
        optn.value = (m + 1);
        // if june selected
        if (m == 1) {
          optn.selected = true;
        }
        month.options.add(optn);
      }
    }

    function visible() {
      var elem = document.getElementById('profileVisibility');
      if (elem) {
        if (elem.innerHTML == "Switch to visible") {
          elem.innerHTML = "Switch to invisible"
        } else {
          elem.innerHTML = "Switch to visible"
        }
      }
    }

    var openFile = function(event) {
      var input = event.target;

      // Instantiate FileReader
      var reader = new FileReader();
      reader.onload = function() {
        imageFile = reader.result;

        document.getElementById("imageChange").innerHTML = '<img width="200" src="' + imageFile + '" class="rounded-circle w-100 shadow" />';
      };
      reader.readAsDataURL(input.files[0]);
    };
  </script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
{% endblock %}

{% block extra_js %}
<script>
document.querySelector(".breadcrumb-item a").innerText = "https://...";


  document.addEventListener("DOMContentLoaded", function () {
    if (document.getElementById("choices-language")) {
      new Choices("#choices-language", { searchEnabled: false });
    }
    
    if (document.getElementById("choices-skills")) {
      new Choices("#choices-skills", {
        removeItemButton: true, // Allows removing selected skills
        duplicateItemsAllowed: false,
      });
    }
  });
</script>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleButton = document.getElementById('flexSwitchCheckDefault');
    const setup2FADiv = document.getElementById('2faSetup');
    const qrCodeImage = document.getElementById('qrCodeImage');
    const badge = document.getElementById('2faStatusBadge');

    // Function to fetch and display the QR code
    async function fetchQRCode() {
      const response = await fetch("{% url 'setup_2fa' %}");
      const data = await response.json();
      if (data.success) {
        qrCodeImage.src = `data:image/png;base64,${data.qr_code_base64}`;
        setup2FADiv.style.display = 'block';
      }
    }

    // Toggle 2FA setup section
    toggleButton.addEventListener('change', function () {
      if (toggleButton.checked) {
        // Enable 2FA
        fetchQRCode();
        badge.textContent = 'Enabled';
        badge.classList.remove('badge-danger');
        badge.classList.add('badge-success');
      } else {
        // Disable 2FA
        fetch("{% url 'disable_2fa' %}", {
          method: 'POST',
          headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            badge.textContent = 'Disabled';
            badge.classList.remove('badge-success');
            badge.classList.add('badge-danger');
            setup2FADiv.style.display = 'none';
          } else {
            alert('Failed to disable 2FA.');
            toggleButton.checked = true; // Revert the toggle
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Failed to disable 2FA.');
          toggleButton.checked = true; // Revert the toggle
        });
      }
    });

    // Cancel button functionality
    document.getElementById('cancel2FAButton').addEventListener('click', function () {
      toggleButton.checked = false;
      toggleButton.dispatchEvent(new Event('change'));
    });
  });
</script>

{% endblock %}